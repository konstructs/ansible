#!/bin/bash

> /tmp/update-konstructs.log

log() {
  echo "[$(date)] $@" >> /tmp/update-konstructs.log
  echo "[$(date)] $@"
}

log "Remove server files"
rm -rf binary meta lib

log "Unpack prod server dump"
# Start from a clean world
#tar xf world.tar.xz

log "Remove old server jar"
rm server.jar

log "Download new dev server.jar"
wget -qO server.jar \
	https://bintray.com/artifact/download/konstructs/jars/konstructs-server-build-dev.jar

# Download plugins
mkdir -p lib
(
cd lib
{% for plugin in konstructs_plugins %}
wget https://bintray.com/artifact/download/konstructs/plugins/{{ plugin.version }}/{{ plugin.name }}.jar
{% endfor %}
)

log "Set owner"
chown -R {{ konstructs_user }} binary meta server.jar

log "All done!"
